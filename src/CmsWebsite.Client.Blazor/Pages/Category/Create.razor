@page "/category/create"
@using CmsWebsite.Client.Blazor.Services.Category
@using System.Text.Json
@using CmsWebsite.Share.Models.Category
@inject NavigationManager uriHelper
@inject ICategoryService _client
@inject NotificationService NotificationService
<h3>Create category</h3>

@*
    TItem: truyền 1 class, đối tượng request để hiển thị dữ liệu
    Data: truyền 1 biến object để bind dữ liệu
    Submit: truyền 1 function
*@

<RadzenTemplateForm TItem="CategoryCreateRequest" Data="@category" Submit=@Createcategory>
    <div class="row">
        <RadzenFieldset>
            <div class="row">
                <div class="col-md-3 align-items-center d-flex">
                    <RadzenLabel Component="ImageFile" Text="ImageFile" />
                </div>
                <div class="col-md-9">
                    <RadzenFileInput TValue="string" @bind-Value="@category.IconFile" Class="w-100" />
                </div>
            </div>
            <div class="row">
                <div class="col-md-3 align-items-center d-flex">
                    <RadzenLabel Component="CategoryName" Text="Category Name" />
                </div>
                <div class="col-md-9">
                    <RadzenTextBox Name="CategoryName" @bind-Value="@category.CategoryName" />
                </div>
            </div>

            <div class="row">
                <div class="col-md-3 align-items-center d-flex">
                    <RadzenLabel Component="Abbreviation" Text="Abbreviation" />
                </div>
                <div class="col-md-9">
                    <RadzenTextBox Name="Abbreviation" @bind-Value="@category.Abbreviation" />
                </div>
            </div>
            <div class="row">
                <div class="col-md-3 align-items-center d-flex">
                    <RadzenLabel  Component="ParentCategoryId" Text="Parent Category" />
                </div>
                <div class="col-md-9">
                    <RadzenDropDown Name="ParentCategoryId" AllowClear="true" Data="@categories" TextProperty="CategoryName" ValueProperty="CategoryId"
                                    @bind-Value=@category.ParentCategoryId Placeholder="Select Parent..." />

                </div>
            </div>
            <div class="row">
                <div class="col-md-3 align-items-center d-flex">
                    <RadzenLabel Component="Level" Text="Level" />
                </div>
                <div class="col-md-9">
                    <RadzenDropDown Name="Level" Data="@MyLevels" TextProperty="EnumName" ValueProperty="EnumValue"
                                    @bind-Value=@category.Level Placeholder="Select Level..." />

                </div>
            </div>

            <div class="row align-items-end justify-content-center">
                <RadzenButton ButtonType="ButtonType.Submit" Text="Save" />
            </div>
        </RadzenFieldset>
    </div>
</RadzenTemplateForm>

@code {
    //[Inject] private IcategoryService _client { get; set; }
    public class EnumLevels
    {
        public Level EnumValue { get; set; }
        public string EnumName { get; set; }
    }
    List<EnumLevels> MyLevels { get; set; } = new List<EnumLevels>();

    private CategoryCreateRequest category = new CategoryCreateRequest()
        {
            Level = 0
        };
    private List<CategoryDTO> categories;

    protected override async Task OnInitializedAsync()
    {
        categories = await _client.GetListCategory();
        // load the list
        foreach (Level item in Enum.GetValues(typeof(Level)))
        {
            MyLevels.Add(new EnumLevels { EnumName = item.ToString(), EnumValue = item });
        }
    }
    async Task Createcategory()
    {
        var result = await _client.CreateCategory(category);
        if (result)
        {
            Console.WriteLine("OK");
            NotificationService.Notify(new NotificationMessage
                {
                    Severity = NotificationSeverity.Success,
                    Summary = "Thông báo sự kiện",
                    Detail = "Thêm thành công",
                    Duration = 4000,
                });
            uriHelper.NavigateTo("/category");
        }
        else
        {
            Console.WriteLine(JsonSerializer.Serialize(category, new JsonSerializerOptions() { WriteIndented = true }));
        }
    }
}
