@inherits LayoutComponentBase
@inject NavigationManager navigationManager
@inject IAuthService auth
@inject IArticleService _client
@inject NavigationManager uriHelper
@inject IJSRuntime JSRuntime
@inject ICategoryService CategoryService
@using CmsWebsite.Client.Blazor.Services.Article
@using CmsWebsite.Client.Blazor.Services.Category;
@using CmsWebsite.Share.Models.Article
@using CmsWebsite.Client.Blazor.Pages.Components;
@using CmsWebsite.Share.Models.Category;


<link href="css/radzen/@(currentTheme).css" rel="stylesheet" />
<div class="page">
    <RadzenDialog />
    <RadzenNotification />

    <AuthorizeView>
        <Authorized>
            <div class="col-md-2 sidebar">
                <NavMenu />
            </div>
        </Authorized>
    </AuthorizeView>

    <div class="col-md-@col">

        <div class="top-row">
            <div class="col-md-3">
                <a href="/" style="text-decoration: none;">
                    <div class="row">
                        <div class="col-md-3">
                            <RadzenImage Path="/img/logo.png" style="width:70px" />
                        </div>
                        <div class="col-md-7 offset-md-2">
                            <span style="color:red; font-weight:700;font-size:16px">MẬT TRẬN TỔ QUỐC VIỆT NAM</span>
                            <br>
                            <span style="color:red; font-size:12px">TRANG THÔNG TIN ĐIỆN TỬ</span>
                            <br />
                            @DayOfWeek(), @DateTime.Now.ToString("dd/MM/yyy")
                        </div>
                    </div>
                </a>
            </div>
            <div class="col-md-5 offset-md-2 icons-wrapper d-flex">
                @*<button type="button" class="btn d-flex" style="font-size:14px"><RadzenIcon Icon="facebook" /><span class="ms-1">Facebook</span></button>*@
                <button type="button" class="btn d-flex" style="font-size:14px"><RadzenIcon Icon="call" Style="color:green" /><span class="ms-1">(025 111 222)</span></button>
                <button type="button" class="btn d-flex" style="font-size:14px"><RadzenIcon Icon="mark_email_read" Style="color:red" /><span class="ms-1">Email</span></button>
            </div>
            <AuthorizeView>
                <Authorized>
                    <div class="col-md-2">
                        <NavLink class="nav-link" href="logout" style="float:right">
                            Xin chào @context.User.Identity.Name !  Thoát <span class="oi oi-power-standby"></span>
                        </NavLink>
                    </div>
                </Authorized>
                @* <NotAuthorized>
                <NavLink class="nav-link" href="login" style="float:right" title="Đăng nhập quản trị">
                <RadzenIcon Icon="manage_accounts" />
                </NavLink>
                </NotAuthorized>*@
            </AuthorizeView>

        </div>

        <AuthorizeView>
            <NotAuthorized>

                <RadzenMenu Style="width: 100%; justify-content: space-between; position: sticky; top: 0; z-index: 1;">
                    <div style="display: flex; align-items: center;">
                        <RadzenMenuItem Icon="home" Path="/"></RadzenMenuItem>
                        @foreach (var category in categories.Take(5))
                        {
                            var subCategory = categories.Where(c => c.ParentCategoryId == category.CategoryId).ToList();
                            @if (category.ParentCategoryId == null)
                            {
                                <div class="dropdown">
                                    <NavLink class="menu" ActiveClass="active-menu" href="@($"chuyenmuc/{category.CategoryId}")">@category.CategoryName</NavLink>
                                    <div class="dropdown-content">
                                    @foreach (var item in subCategory)
                                    {
                                        <a href="chuyenmuc/@item.CategoryId">@item.CategoryName</a>
                                    }
                                    </div>
                                </div>
                            }
                        }
                    </div>
                    <div style="position: relative;">
                        <RadzenMenuItem Icon="@(isMenu == false ? "menu" : "highlight_off")" Click="() => isMenu = !isMenu" />
                        <div class="row sub-menu" style="@(isMenu == false ? "display: none;" : "display: block;")">
                            <h4>TẤT CẢ CHUYÊN MỤC</h4>
                            <div class="row">
                                @foreach (var category in categories)
                                {
                                    <div class="col-md-4 py-2 sub-menu-line">
                                        <a class="title" href="chuyenmuc/@category.CategoryId">@category.CategoryName</a>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </RadzenMenu>


            </NotAuthorized>
        </AuthorizeView>

        <div class="content">
            @Body
        </div>

    </div>

    <AuthorizeView>
        <NotAuthorized>
            <div class="col-md-3 my-2">
                @*<RadzenButton Variant="Variant.Text" ButtonStyle="ButtonStyle.Warning" Click=@(args => ChangeThem())>
                <RadzenIcon Icon="@modeTheme" />
                </RadzenButton>*@
                <RadzenButton Variant="Variant.Text" ButtonStyle="ButtonStyle.Warning" Click=@(arg => uriHelper.NavigateTo("components/guibanbientap"))>
                    <RadzenIcon Icon="forward_to_inbox" />
                </RadzenButton>
                <RadzenButton Variant="Variant.Text" ButtonStyle="ButtonStyle.Warning" Click=@OnSearch>
                    <RadzenIcon Icon="search" />
                </RadzenButton>
                <RadzenTextBox Style="@(isSearch == false ? "position: absolute; top: -9999px;" : "position: absolute; z-index: 1; top: 0; width: 268px;")" id="txtSearch" Change=@OnInput class="form-control" Placeholder="Tìm kiếm thông tin" @onblur="LostFocus" />

                <LienKetWebsite></LienKetWebsite>
                <DanhSachMatTran></DanhSachMatTran>
                <VanBanPhapLuat></VanBanPhapLuat>
            </div>
        </NotAuthorized>
    </AuthorizeView>

</div>
<Footer></Footer>

@functions {
    bool isSearch = false;
    bool isMenu = false;
    int col = 10;
    string currentTheme = "standard";
    string modeTheme = "dark_mode";

    [CascadingParameter]
    Task<AuthenticationState> AuthenticationState { get; set; }

    protected List<ArticleDTO> articles { get; set; }
    public List<CategoryDTO> categories = new();
    protected override async Task OnInitializedAsync()
    {
        articles = await _client.GetListArticle();
        categories = await CategoryService.GetListCategory();
    }

    protected override async Task OnParametersSetAsync()
    {
        if (!(await AuthenticationState).User.Identity.IsAuthenticated)
        {
            col = 9;
        }
    }
    void ChangeThem()
    {
        if (currentTheme == "material")

        {
            currentTheme = "standard";
            modeTheme = "dark_mode";
        }
        else
        {
            currentTheme = "material";
            modeTheme = "light_mode";

        }

    }
    private string DayOfWeek()
    {
        int day = (int)DateTime.Now.DayOfWeek;
        switch (day)
        {
            case 1:
                return "Thứ hai";
            case 2:
                return "Thứ ba";
            case 3:
                return "Thứ tư";
            case 4:
                return "Thứ năm";
            case 5:
                return "Thứ sáu";
            case 6:
                return "Thứ bảy";
            default:
                return "Chủ nhật";

        }
    }
    async Task OnSearch()
    {
        isSearch = true;
        await JSRuntime.InvokeVoidAsync("focusSearch");
    }
    void OnInput(string value)
    {
        uriHelper.NavigateTo($"timkiem/{value}");
        isSearch = false;
    }
    void LostFocus() => isSearch = false;
    void NavigateCategory(Guid id)
    {
        Console.WriteLine(id);
        uriHelper.NavigateTo($"chuyenmuc/{id}");
    }
}